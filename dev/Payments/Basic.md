# Basic

- [基础概念](https://merlin-li.github.io/zksync/payments#basic-concepts)
    - [操作](https://merlin-li.github.io/zksync/payments#operations)
        - [优先操作](https://merlin-li.github.io/zksync/payments#priority-operations)
        - [交易](https://merlin-li.github.io/zksync/payments#transactions)
    - [区块](https://merlin-li.github.io/zksync/payments#blocks)
    - [工作流程](https://merlin-li.github.io/zksync/payments#flow)
        - [创建账户](https://merlin-li.github.io/zksync/payments#creating-an-account)
        - [设置签名秘钥](https://merlin-li.github.io/zksync/payments#setting-the-signing-key)
        - [存入资金](https://merlin-li.github.io/zksync/payments#transferring-funds)
        - [手续费](https://merlin-li.github.io/zksync/payments#fees)
        - [提取资金](https://merlin-li.github.io/zksync/payments#withdrawing-funds)

## **操作**

zkSync 中有两种操作:

1. 优先操作
2. 交易

### **优先操作**

优先操作直接在以太坊主网上启动。 例如，用户创建存款交易以将资金从以太坊转移到 zkSync。 优先级操作可以用创建它的以太坊交易的数字 ID 或哈希来标识。

目前，有以下几种优先级操作：

- **存款**: 将资金从以太坊网络转移到 zkSync 网络中的指定账户。 如果接收方帐户在 zkSync 网络上尚不存在，则会创建该帐户并为提供的地址分配一个数字 ID。
- **FullExit**: 将资金从 zkSync 网络提取到以太坊网络，而不与 zkSync 服务器交互。 此操作可用于在检测到来自 zkSync 服务器节点的审查时紧急退出，或在 zkSync 网络中的帐户无法设置签名密钥的情况下提取资金（例如，如果地址对应于智能合约）。

### **交易**

交易必须通过 zkSync 操作员使用 API 提交。

事务由其序列化表示的哈希标识。

目前，有以下几种交易类型：

- **ChangePubKey**: 设置（或更改）与帐户关联的签名密钥。 没有签名密钥集，没有操作（优先操作除外）可通过相应账号授权。
- **Transfer**: 将资金从一个 zkSync 账户转移到另一个 zkSync 账户。 如果收款人账户不存在然而在 zkSync 网络上，它会被创建并且一个数字 ID 会被分配给提供的地址。
- **Swap**: 在两个现有 zkSync 账户之间自动交换资金。
- **Withdraw**: 从 zkSync 网络提取资金到以太坊网络。
- **ForcedExit**: 从没有设置签名密钥的“目标”L2 账户提取资金到以太坊网络上的相同“目标”地址。 此操作可用于在 zkSync 网络中无法设置账户签名密钥的情况下（例如，如果地址对应于智能合约），可以提取资金。
- **MintNFT**: 根据提供的内容哈希向提供的“收件人”铸造一个 NFT。
- **WithdrawNFT**: 从 zkSync 网络中提取 NFT 到以太坊网络。

## **区块**

zkSync 内部的所有操作都以块的形式排列。 zkSync 算子创建区块后，通过 Commit 交易将其推送到以太坊主网上的 zkSync 智能合约。 当一个块被提交时，它的状态还不是最终的。 几分钟后，生成了该区块正确性的 ZK 证明。 该证明使用验证交易在以太坊上发布。 只有在验证交易被挖掘后，新状态才被认为是最终状态。 可以提交多个块但尚未验证。

但是，执行模型略有不同：为了不让用户等待区块完成，交易被分组为“小区块”，超时时间要小得多。 因此，区块以很小的间隔被部分应用，因此在收到交易后不久就会执行它并相应地更新 L2 状态。

即用户发送一笔交易后，无需等待区块承诺，也无需等待验证，转账的资金在相应交易执行后即可立即使用。

## **工作流**

本节按顺序描述 zkSync 的典型用例。

### **创建账户**

zkSync 中的账户可以通过从以太坊存入资金或将 zkSync 中的资金转移到所需地址来创建。 如果 zkSync 网络不存在，这些选项中的任何一个都将在 zkSync 网络中创建一个新帐户。

但是，新创建的账户还不能授权任何交易。 为此，帐户所有者必须为其帐户设置签名密钥。

### **设置签名秘钥**

默认情况下，每个帐户的签名密钥设置为零值，这将帐户标记为“无主”。 这是一个要求，因为以下原因：

- 如果向某个地址的转账在以太坊中有效，那么在 zkSync 中也有效。
- 不是每个地址都可以有一个私钥（例如一些智能合约）。
- 在用户对 zkSync 感兴趣之前，可能会转移到用户的帐户。

因此，为了使账户能够发起 L2 交易，用户必须通过 ChangePubKey 交易为其设置签名密钥。

交易必须有两个签名：

- zkSync 交易数据的签名，这样就不可能改变交易内容。
- 证明账户所有权的以太坊签名。

以太坊签名应该是一些预定义消息的签名。 此外，还可以通过向 zkSync 智能合约发送相应的交易来授权链上 **ChangePubKey** 操作。 zkSync 服务器和智能合约都将检查账户的所有权，以提供更好的安全保障。

所有交易字段上的 zkSync 签名必须与交易中提供的公钥相对应。

### **转移资金**

如上所述，任何在以太坊中有效的转账，在 zkSync 中也有效。

用户可以用 Ether 或任何受支持的 ERC-20 代币转移任意数量的资金。 可以在相应的资源管理器页面上找到支持的[代币列表](https://zkscan.io/explorer/tokens)。也可以在 [API](https://merlin-li.github.io/api) 中找到。

但是，转账到不存在的账户需要在智能合约上发送稍微多一点的数据（我们必须包含有关新账户的信息），因此此类转账的费用略高于向现有账户转账的费用。

### **手续费**

zkSync 需要交易费用以支付网络维护费用。

每种交易的费用是根据三个主要因素计算的：

- 发送到以太坊网络的数据量。
- 当前的Gas Price。
- 为带有交易的区块生成证明的计算资源成本。

由于我们在一个区块中包含许多交易，因此成本会在所有包含的交易中分摊，这会导致非常小的费用。

此外，我们的 API 通过相应的 [API](https://merlin-li.github.io/api/v0.1.html#get-tx-fee) 方法提供用于费用计算的所有输入数据。

### **提现**

目前，可以通过三种方式从 zkSync 提取资金到以太坊账户。

首先是 **提现** 交易。

这是一个 L2 交易，可用于请求从您的账户提款到任何以太坊地址。 与转账方式相同，它必须由正确的 zkSync 私钥签名。

此方法适用于您拥有自己账户私钥的情况。

第二种是 **ForcedExit** 交易。

这是一个 L2 交易，可用于请求从任何无主账户（没有签名密钥集的账户）提款。 在此交易中不能选择以太坊地址或金额：唯一的选择是请求将某个代币的所有可用资金从目标 L2 地址提取到目标 L1 地址。

此外，交易发起人应支付费用，这与**提款**操作完全相同。

如果需要从无法设置签名密钥的账户（即智能合约账户）提取资金，并且存在可以发送此类交易的 L2 账户，则首选此方法。

第三种是 **FullExit** 优先操作。

这种操作被称为“优先操作”，因为它是从 L1 发起的，并且智能合约提供了保证，要么该请求将在合理的时间间隔内处理，要么网络将被视为受损/死机，并且合约将进入外流 模式。

如果用户将经历网络运营商的审查，则首选此方法。